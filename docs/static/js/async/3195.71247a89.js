"use strict";(self.webpackChunkant_admin_template=self.webpackChunkant_admin_template||[]).push([["3195"],{98021(e,l,s){s.r(l)},47419(e,l,s){s.r(l)},16550(e,l,s){s.r(l)},71696(e,l,s){s.r(l)},24889(e,l,s){s.r(l)},33782(e,l,s){s.r(l),s.d(l,{default:()=>f});var o=s(74848),a=s(96540),t=s(17125),n=s(46860),d=s(81696),i=s(64889);s(75289);var c=s(53054),r=s(74225),p=s(27496),u=s(78925),m=s(79139),x=s(63116);s(98021);let g=[{id:"1",type:"custom",position:{x:250,y:50},data:{label:"开始",type:"start"}}],h=[],f=()=>{let{t:e}=(0,c.Bd)(),[l,s,f]=(0,n.ck)(g),[v,j,b]=(0,n.fM)(h),[y,w]=(0,a.useState)(null),[C,A]=(0,a.useState)([]),[_,k]=(0,a.useState)(!1),[N,z]=(0,a.useState)(null),[E,S]=(0,a.useState)(!1),[D,L]=(0,a.useState)(null),[P,T]=(0,a.useState)(null),{fitView:$,zoomIn:F,zoomOut:I}=(0,n.VH)(),V=(0,a.useMemo)(()=>({custom:r.CustomNode}),[]),B=(0,a.useMemo)(()=>({custom:p.CustomEdge}),[]),M=(0,a.useCallback)(e=>{let l={...e,type:"custom",animated:!0,markerEnd:{type:n.TG.ArrowClosed}};j(e=>(0,n.rN)(l,e))},[j]),O=(0,a.useCallback)((e,l)=>{A([l.id])},[]),X=(0,a.useCallback)((e,l)=>{e.stopPropagation(),T(l),L({x:e.clientX,y:e.clientY}),S(!0)},[]),q=(0,a.useCallback)(()=>{A([])},[]),G=(0,a.useCallback)(l=>{P&&(j(e=>e.map(e=>e.id===P.id?{...e,label:l,data:{...e.data,label:l}}:e)),t.Ay.success(e("pages.flow:edgeLabelSaved")))},[P,j,e]),H=(0,a.useCallback)(o=>{let a=`${Date.now()}`,n=l[l.length-1],d=(null==n?void 0:n.position.x)||250,i=(null==n?void 0:n.position.y)||50,c=l.length,r={id:a,type:"custom",position:{x:d+100*Math.floor(c/3),y:i+c%3*60},data:{label:e(`pages.flow:${o}Node`),type:o}};s(e=>[...e,r]),t.Ay.success(e("pages.flow:nodeAdded"))},[l,s,e]),R=(0,a.useCallback)((e,l)=>{e.preventDefault(),w(l),z({x:e.clientX,y:e.clientY}),k(!0)},[]),Y=(0,a.useCallback)(l=>{s(e=>e.map(e=>e.id===l.id?l:e)),t.Ay.success(e("pages.flow:nodeSaved"))},[s,e]),Z=(0,a.useCallback)(()=>{y&&(s(e=>e.filter(e=>e.id!==y.id)),j(e=>e.filter(e=>e.source!==y.id&&e.target!==y.id)),k(!1),w(null),t.Ay.success(e("pages.flow:nodeDeleted")))},[y,s,j,e]),J=(0,a.useCallback)(()=>{let s={nodes:l,edges:v,timestamp:Date.now()};localStorage.setItem("flowDesign",JSON.stringify(s)),t.Ay.success(e("pages.flow:flowSaved"))},[l,v,e]),K=(0,a.useCallback)(()=>{s(g),j(h),t.Ay.success(e("pages.flow:flowCleared"))},[s,j,e]);(0,a.useEffect)(()=>{let l=l=>{"Delete"!==l.key&&"Backspace"!==l.key||!(C.length>0)||_||E||(j(e=>e.filter(e=>!C.includes(e.id))),A([]),t.Ay.success(e("pages.flow:edgeDeleted")),l.preventDefault())};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[C,_,E,j,e]);let Q=(0,a.useCallback)(()=>{F()},[F]),U=(0,a.useCallback)(()=>{I()},[I]),W=(0,a.useCallback)(()=>{$({padding:.2,duration:300})},[$]);return(0,o.jsxs)("div",{className:"flow-designer",children:[(0,o.jsx)(u.Toolbar,{onAddNode:H,onSave:J,onClear:K,onZoomIn:Q,onZoomOut:U,onFitView:W}),(0,o.jsx)("div",{className:"flow-designer__canvas",children:(0,o.jsxs)(n.Gc,{nodes:l,edges:v,onNodesChange:f,onEdgesChange:b,onConnect:M,onNodeContextMenu:R,onEdgeClick:O,onEdgeDoubleClick:X,onPaneClick:q,nodeTypes:V,edgeTypes:B,defaultEdgeOptions:{type:"custom",animated:!0},fitView:!0,attributionPosition:"bottom-left",children:[(0,o.jsx)(d.V,{variant:d._.Dots,gap:16,size:1}),(0,o.jsx)(i.H,{})]})}),(0,o.jsx)(m.NodePopover,{visible:_,node:y,position:N,onClose:()=>k(!1),onSave:Y,onDelete:Z}),(0,o.jsx)(x.EdgeLabelPopover,{visible:E,initialLabel:"string"==typeof(null==P?void 0:P.label)?P.label:(null==P?void 0:P.data)&&"label"in P.data?String(P.data.label||""):"",position:D,onClose:()=>S(!1),onSave:G})]})}},27496(e,l,s){s.r(l),s.d(l,{CustomEdge:()=>t});var o=s(74848);s(96540);var a=s(46860);let t=e=>{let{id:l,sourceX:s,sourceY:t,targetX:n,targetY:d,sourcePosition:i,targetPosition:c,style:r={},markerEnd:p,label:u,data:m}=e,[x,g,h]=(0,a.Fp)({sourceX:s,sourceY:t,sourcePosition:i,targetX:n,targetY:d,targetPosition:c});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.tE,{id:l,path:x,markerEnd:p,style:r}),(u||(null==m?void 0:m.label))&&(0,o.jsx)(a.rV,{children:(0,o.jsx)("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${g}px,${h}px)`,pointerEvents:"all",background:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",border:"1px solid #d9d9d9",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},className:"custom-edge-label",children:u||(null==m?void 0:m.label)})})]})}},63116(e,l,s){s.r(l),s.d(l,{EdgeLabelPopover:()=>c});var o=s(74848),a=s(96540),t=s(26149),n=s(36813),d=s(58607),i=s(53054);s(47419);let c=e=>{let{visible:l,initialLabel:s="",position:c,onClose:r,onSave:p}=e,{t:u}=(0,i.Bd)(),[m,x]=(0,a.useState)(s);(0,a.useEffect)(()=>{x(s)},[s]);let g=()=>{p(m),r()};return l&&c?(0,o.jsx)("div",{className:"edge-label-popover",style:{position:"fixed",left:c.x,top:c.y,zIndex:1e3},children:(0,o.jsxs)("div",{className:"edge-label-popover__content",children:[(0,o.jsx)("div",{className:"edge-label-popover__title",children:u("pages.flow:edgeLabel")}),(0,o.jsx)(t.A,{value:m,onChange:e=>{e.stopPropagation(),x(e.target.value)},onKeyDown:e=>{"Enter"===e.key?g():"Escape"===e.key&&r()},placeholder:u("pages.flow:edgeLabelPlaceholder"),autoFocus:!0,maxLength:50}),(0,o.jsx)("div",{className:"edge-label-popover__footer",children:(0,o.jsxs)(n.A,{children:[(0,o.jsx)(d.Ay,{size:"small",onClick:r,children:u("pages.flow:cancel")}),(0,o.jsx)(d.Ay,{size:"small",type:"primary",onClick:g,children:u("pages.flow:save")})]})})]})}):null}},79139(e,l,s){s.r(l),s.d(l,{NodePopover:()=>p});var o=s(74848),a=s(96540),t=s(68874),n=s(26149),d=s(36813),i=s(58607),c=s(30887),r=s(53054);s(16550);let p=e=>{let{visible:l,node:s,position:p,onClose:u,onSave:m,onDelete:x}=e,{t:g}=(0,r.Bd)(),[h]=t.A.useForm();if((0,a.useEffect)(()=>{s&&h.setFieldsValue({label:s.data.label,description:s.data.description||""})},[s,h]),!s||!p||!l)return null;let f=(0,o.jsxs)("div",{className:"node-popover",children:[(0,o.jsx)("div",{className:"node-popover__title",children:g("pages.flow:nodeConfig")}),(0,o.jsxs)(t.A,{form:h,layout:"vertical",size:"small",children:[(0,o.jsx)(t.A.Item,{name:"label",label:g("pages.flow:nodeLabel"),rules:[{required:!0,message:g("pages.flow:nodeLabelRequired")}],children:(0,o.jsx)(n.A,{placeholder:g("pages.flow:nodeLabelPlaceholder")})}),(0,o.jsx)(t.A.Item,{name:"description",label:g("pages.flow:nodeDescription"),children:(0,o.jsx)(n.A.TextArea,{placeholder:g("pages.flow:nodeDescriptionPlaceholder")})})]}),(0,o.jsx)("div",{className:"node-popover__footer",children:(0,o.jsxs)(d.A,{children:[(0,o.jsx)(i.Ay,{size:"small",onClick:u,children:g("pages.flow:cancel")}),(0,o.jsx)(i.Ay,{size:"small",danger:!0,onClick:()=>{x(),u()},children:g("pages.flow:delete")}),(0,o.jsx)(i.Ay,{size:"small",type:"primary",onClick:()=>{h.validateFields().then(e=>{s&&(m({...s,data:{...s.data,label:e.label,description:e.description}}),u())})},children:g("pages.flow:save")})]})})]});return(0,o.jsx)("div",{className:"node-popover-wrapper",style:{position:"fixed",left:p.x,top:p.y,zIndex:1e3},children:(0,o.jsx)(c.A,{closable:!0,content:f,open:l,onOpenChange:e=>!e&&u(),trigger:"click",placement:"rightTop",children:(0,o.jsx)("div",{style:{width:0,height:0}})})})}},78925(e,l,s){s.r(l),s.d(l,{Toolbar:()=>h});var o=s(74848);s(96540);var a=s(36813),t=s(58607),n=s(69369),d=s(17047),i=s(19416),c=s(87281),r=s(54042),p=s(72796),u=s(96458),m=s(20156),x=s(19791),g=s(53054);s(71696);let h=e=>{let{onAddNode:l,onSave:s,onClear:h,onZoomIn:f,onZoomOut:v,onFitView:j}=e,{t:b}=(0,g.Bd)();return(0,o.jsxs)("div",{className:"flow-toolbar",children:[(0,o.jsxs)("div",{className:"flow-toolbar__section",children:[(0,o.jsxs)("div",{className:"flow-toolbar__label",children:[b("pages.flow:addNode"),":"]}),(0,o.jsxs)(a.A,{children:[(0,o.jsx)(t.Ay,{icon:(0,o.jsx)(n.A,{}),onClick:()=>l("start"),size:"small",children:b("pages.flow:startNode")}),(0,o.jsx)(t.Ay,{icon:(0,o.jsx)(d.A,{}),onClick:()=>l("process"),size:"small",children:b("pages.flow:processNode")}),(0,o.jsx)(t.Ay,{icon:(0,o.jsx)(i.A,{}),onClick:()=>l("decision"),size:"small",children:b("pages.flow:decisionNode")}),(0,o.jsx)(t.Ay,{icon:(0,o.jsx)(c.A,{}),onClick:()=>l("end"),size:"small",children:b("pages.flow:endNode")})]})]}),(0,o.jsx)("div",{className:"flow-toolbar__divider"}),(0,o.jsx)("div",{className:"flow-toolbar__section",children:(0,o.jsxs)(a.A,{children:[(0,o.jsx)(t.Ay,{icon:(0,o.jsx)(r.A,{}),onClick:f,size:"small",children:b("pages.flow:zoomIn")}),(0,o.jsx)(t.Ay,{icon:(0,o.jsx)(p.A,{}),onClick:v,size:"small",children:b("pages.flow:zoomOut")}),(0,o.jsx)(t.Ay,{icon:(0,o.jsx)(u.A,{}),onClick:j,size:"small",children:b("pages.flow:fitView")})]})}),(0,o.jsx)("div",{className:"flow-toolbar__divider"}),(0,o.jsx)("div",{className:"flow-toolbar__section",children:(0,o.jsxs)(a.A,{children:[(0,o.jsx)(t.Ay,{type:"primary",icon:(0,o.jsx)(m.A,{}),onClick:s,size:"small",children:b("pages.flow:save")}),(0,o.jsx)(t.Ay,{danger:!0,icon:(0,o.jsx)(x.A,{}),onClick:h,size:"small",children:b("pages.flow:clear")})]})})]})}},52538(e,l,s){s.r(l),s.d(l,{CustomNode:()=>r});var o=s(74848),a=s(96540),t=s(46860),n=s(69369),d=s(17047),i=s(19416),c=s(87281);s(24889);let r=(0,a.memo)(e=>{let{data:l,selected:s}=e,{label:a,type:r,description:p}=l;return(0,o.jsxs)("div",{className:`custom-node custom-node--${r} ${s?"custom-node--selected":""}`,children:["start"!==r&&(0,o.jsx)(t.h7,{type:"target",position:t.yX.Top,className:`custom-node__handle custom-node__handle--target ${"decision"===r?"custom-node__handle--decision-target":""}`}),(0,o.jsxs)("div",{className:"custom-node__header",children:[(0,o.jsx)("div",{className:"custom-node__icon",children:(()=>{switch(r){case"start":return(0,o.jsx)(n.A,{});case"process":return(0,o.jsx)(d.A,{});case"decision":return(0,o.jsx)(i.A,{});case"end":return(0,o.jsx)(c.A,{});default:return null}})()}),(0,o.jsx)("div",{className:"custom-node__label",children:a})]}),p&&(0,o.jsx)("div",{className:"custom-node__description",children:p}),"end"!==r&&(0,o.jsx)(t.h7,{type:"source",position:t.yX.Bottom,className:`custom-node__handle custom-node__handle--source ${"decision"===r?"custom-node__handle--decision-source":""}`})]})});r.displayName="CustomNode"},74225(e,l,s){s.r(l),s.d(l,{CustomNode:()=>o.CustomNode});var o=s(52538)}}]);