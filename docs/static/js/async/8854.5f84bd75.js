"use strict";(self.webpackChunkant_admin_template=self.webpackChunkant_admin_template||[]).push([["8854"],{3056(e,r,l){l.r(r)},19413(e,r,l){l.r(r),l.d(r,{default:()=>S});var t=l(74848),a=l(96540),s=l(99373),i=l(58607),o=l(40244),n=l(16629),c=l(47152),d=l(16370),m=l(57486),x=l(36813),p=l(98254),A=l(17481),R=l(36223),h=l(71870),j=l(7532),y=l(18941),E=l(65350),u=l(17047),v=l(68866),g=l(46029),_=l(59358);l(3056);let S=()=>{let[e,r]=(0,a.useState)([]),[l,S]=(0,a.useState)({total:0,byType:{},byLevel:{}}),[T,k]=(0,a.useState)(null),[I,b]=(0,a.useState)(!1),O=()=>{r(_.default.getErrors()),S(_.default.getStatistics())};(0,a.useEffect)(()=>{O();let e=setInterval(O,2e3);return()=>clearInterval(e)},[]);let N=e=>({[_.ErrorType.REACT_ERROR]:"blue",[_.ErrorType.JS_ERROR]:"orange",[_.ErrorType.PROMISE_ERROR]:"purple",[_.ErrorType.RESOURCE_ERROR]:"cyan",[_.ErrorType.NETWORK_ERROR]:"red"})[e]||"default",f=e=>({[_.ErrorLevel.INFO]:"green",[_.ErrorLevel.WARNING]:"orange",[_.ErrorLevel.ERROR]:"red",[_.ErrorLevel.FATAL]:"magenta"})[e]||"default",w=e=>({[_.ErrorType.REACT_ERROR]:"React 错误",[_.ErrorType.JS_ERROR]:"JS 错误",[_.ErrorType.PROMISE_ERROR]:"Promise 错误",[_.ErrorType.RESOURCE_ERROR]:"资源错误",[_.ErrorType.NETWORK_ERROR]:"网络错误"})[e]||e,C=[{title:"ID",dataIndex:"id",key:"id",width:180,ellipsis:!0},{title:"类型",dataIndex:"type",key:"type",width:120,render:e=>(0,t.jsx)(s.A,{className:`tag-${N(e)}`,children:w(e)})},{title:"级别",dataIndex:"level",key:"level",width:100,render:e=>(0,t.jsx)(s.A,{className:`tag-${f(e)}`,children:e.toUpperCase()})},{title:"错误消息",dataIndex:"message",key:"message",ellipsis:!0},{title:"时间",dataIndex:"timestamp",key:"timestamp",width:180,render:e=>new Date(e).toLocaleString("zh-CN")},{title:"操作",key:"action",width:100,render:(e,r)=>(0,t.jsx)(i.Ay,{type:"link",icon:(0,t.jsx)(j.A,{}),onClick:()=>{k(r),b(!0)},children:"详情"})}];return(0,t.jsxs)("div",{className:"error-monitor-demo",children:[(0,t.jsx)("h1",{children:"\uD83D\uDD0D 错误监控与上报系统"}),(0,t.jsx)(o.A,{message:"功能说明",description:"本系统自动监控和上报应用中的各类错误，包括 React 错误、JavaScript 错误、Promise rejection、资源加载失败和网络请求失败。错误会被存储在本地和上报到服务器。",type:"info",showIcon:!0,style:{marginBottom:24}}),(0,t.jsxs)(n.A,{title:"错误统计",className:"error-monitor-demo__stats",children:[(0,t.jsxs)(c.A,{gutter:16,children:[(0,t.jsx)(d.A,{span:6,children:(0,t.jsx)(m.A,{title:"总错误数",value:l.total,prefix:(0,t.jsx)(y.A,{})})}),(0,t.jsx)(d.A,{span:6,children:(0,t.jsx)(m.A,{title:"React 错误",value:l.byType[_.ErrorType.REACT_ERROR]||0,valueStyle:{color:"#1890ff"}})}),(0,t.jsx)(d.A,{span:6,children:(0,t.jsx)(m.A,{title:"JS 错误",value:l.byType[_.ErrorType.JS_ERROR]||0,valueStyle:{color:"#fa8c16"}})}),(0,t.jsx)(d.A,{span:6,children:(0,t.jsx)(m.A,{title:"网络错误",value:l.byType[_.ErrorType.NETWORK_ERROR]||0,valueStyle:{color:"#f5222d"}})})]}),(0,t.jsxs)(c.A,{gutter:16,style:{marginTop:24},children:[(0,t.jsx)(d.A,{span:6,children:(0,t.jsx)(m.A,{title:"严重错误",value:l.byLevel[_.ErrorLevel.FATAL]||0,valueStyle:{color:"#eb2f96"}})}),(0,t.jsx)(d.A,{span:6,children:(0,t.jsx)(m.A,{title:"错误",value:l.byLevel[_.ErrorLevel.ERROR]||0,valueStyle:{color:"#f5222d"}})}),(0,t.jsx)(d.A,{span:6,children:(0,t.jsx)(m.A,{title:"警告",value:l.byLevel[_.ErrorLevel.WARNING]||0,valueStyle:{color:"#fa8c16"}})}),(0,t.jsx)(d.A,{span:6,children:(0,t.jsx)(m.A,{title:"信息",value:l.byLevel[_.ErrorLevel.INFO]||0,valueStyle:{color:"#52c41a"}})})]})]}),(0,t.jsxs)(n.A,{title:"\uD83E\uDDEA 触发测试错误",className:"error-monitor-demo__trigger",children:[(0,t.jsxs)(x.A,{size:"large",wrap:!0,children:[(0,t.jsx)(i.Ay,{danger:!0,type:"primary",icon:(0,t.jsx)(y.A,{}),onClick:()=>{throw Error("\uD83D\uDC1B 这是一个测试的 React 渲染错误！")},children:"触发 React 错误"}),(0,t.jsx)(i.Ay,{danger:!0,icon:(0,t.jsx)(E.A,{}),onClick:()=>{Promise.reject(Error("⚠️ 这是一个测试的 Promise rejection 错误！"))},children:"触发 Promise 错误"}),(0,t.jsx)(i.Ay,{danger:!0,icon:(0,t.jsx)(u.A,{}),onClick:()=>{setTimeout(()=>{throw Error("⏰ 这是一个测试的异步错误！")},100)},children:"触发异步错误"}),(0,t.jsx)(i.Ay,{danger:!0,icon:(0,t.jsx)(v.A,{}),onClick:()=>{_.default.reportNetworkError("模拟的网络请求失败",{url:"/api/test",method:"GET",status:500}),O()},children:"触发网络错误"})]}),(0,t.jsx)(o.A,{message:"提示",description:"点击按钮后会触发相应类型的错误。React 错误会导致当前页面崩溃并显示 ErrorBoundary 页面，其他错误会被自动捕获并记录。",type:"warning",showIcon:!0,style:{marginTop:16}})]}),(0,t.jsx)(n.A,{title:"错误日志列表",extra:(0,t.jsx)(i.Ay,{danger:!0,icon:(0,t.jsx)(g.A,{}),onClick:()=>{h.A.confirm({title:"确认清除",content:"确定要清除所有错误日志吗？",onOk:()=>{_.default.clearErrors(),O()}})},disabled:0===e.length,children:"清除所有日志"}),className:"error-monitor-demo__list",children:(0,t.jsx)(p.A,{dataSource:e,columns:C,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条记录`}})}),(0,t.jsx)(A.A,{title:"错误详情",open:I,onCancel:()=>b(!1),footer:[(0,t.jsx)(i.Ay,{onClick:()=>b(!1),children:"关闭"},"close")],width:800,children:T&&(0,t.jsx)("div",{className:"error-monitor-demo__detail",children:(0,t.jsxs)(R.A,{bordered:!0,column:1,children:[(0,t.jsx)(R.A.Item,{label:"错误 ID",children:T.id}),(0,t.jsx)(R.A.Item,{label:"错误类型",children:(0,t.jsx)(s.A,{className:`tag-${N(T.type)}`,children:w(T.type)})}),(0,t.jsx)(R.A.Item,{label:"错误级别",children:(0,t.jsx)(s.A,{className:`tag-${f(T.level)}`,children:T.level.toUpperCase()})}),(0,t.jsx)(R.A.Item,{label:"错误消息",children:T.message}),(0,t.jsx)(R.A.Item,{label:"页面 URL",children:T.url}),(0,t.jsx)(R.A.Item,{label:"发生时间",children:new Date(T.timestamp).toLocaleString("zh-CN")}),(0,t.jsx)(R.A.Item,{label:"用户代理",children:(0,t.jsx)("div",{style:{wordBreak:"break-all"},children:T.userAgent})}),T.stack&&(0,t.jsx)(R.A.Item,{label:"错误堆栈",children:(0,t.jsx)("pre",{className:"error-monitor-demo__stack",children:T.stack})}),T.componentStack&&(0,t.jsx)(R.A.Item,{label:"组件堆栈",children:(0,t.jsx)("pre",{className:"error-monitor-demo__stack",children:T.componentStack})}),T.extra&&(0,t.jsx)(R.A.Item,{label:"额外信息",children:(0,t.jsx)("pre",{className:"error-monitor-demo__stack",children:JSON.stringify(T.extra,null,2)})})]})})})]})}}}]);