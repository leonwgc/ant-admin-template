"use strict";(self.webpackChunkant_admin_template=self.webpackChunkant_admin_template||[]).push([["3318"],{1248(e,t,s){s.r(t)},5591(e,t,s){s.r(t),s.d(t,{usePreventDuplicate:()=>r,usePreventDuplicateBySign:()=>l,usePreventDuplicateSync:()=>i});var n=s(96540);function r(e){let t=(0,n.useRef)(!1);return(0,n.useCallback)(async function(){for(var s=arguments.length,n=Array(s),r=0;r<s;r++)n[r]=arguments[r];if(!t.current){t.current=!0;try{return await e(...n)}finally{t.current=!1}}},[e])}function l(e){let t=(0,n.useRef)(new Set);return(0,n.useCallback)(async function(){for(var s=arguments.length,n=Array(s),r=0;r<s;r++)n[r]=arguments[r];let l=JSON.stringify(n);if(!t.current.has(l)){t.current.add(l);try{return await e(...n)}finally{t.current.delete(l)}}},[e])}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,s=(0,n.useRef)(0);return(0,n.useCallback)(function(){for(var n=arguments.length,r=Array(n),l=0;l<n;l++)r[l]=arguments[l];let i=Date.now();if(!(i-s.current<t))return s.current=i,e(...r)},[e,t])}},15893(e,t,s){s.r(t),s.d(t,{default:()=>_});var n=s(74848),r=s(96540),l=s(17125),i=s(16629),c=s(47152),a=s(16370),o=s(57486),d=s(15398),u=s(58607),h=s(40244),p=s(36813),m=s(36223),x=s(99373),j=s(17047),y=s(45279),A=s(56304),g=s(85402),f=s(5591),v=s(8161);s(1248);let _=()=>{let[e,t]=(0,r.useState)(0),[s,_]=(0,r.useState)(0),q=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise(t=>{setTimeout(()=>{t({success:!0,data:"Mock data"})},e)})},b=(0,f.usePreventDuplicate)(async()=>{_(e=>e+1),await q(2e3),l.Ay.success("请求完成")}),k=(0,f.usePreventDuplicateBySign)(async e=>{_(e=>e+1),await q(1500),l.Ay.success(`用户${e}的数据加载完成`)}),w=(0,f.usePreventDuplicateSync)(()=>{t(e=>e+1),l.Ay.info("按钮被点击")},1e3);return(0,n.jsxs)("div",{className:"request-control-demo",children:[(0,n.jsxs)("div",{className:"request-control-demo__header",children:[(0,n.jsx)("h2",{children:"防重复提交功能演示"}),(0,n.jsx)("p",{className:"request-control-demo__description",children:"展示防重复提交、请求去重等安全控制功能"})]}),(0,n.jsxs)(i.A,{title:"实时统计",className:"request-control-demo__card",children:[(0,n.jsxs)(c.A,{gutter:[16,16],children:[(0,n.jsx)(a.A,{span:8,children:(0,n.jsx)(o.A,{title:"点击次数",value:e,prefix:(0,n.jsx)(j.A,{})})}),(0,n.jsx)(a.A,{span:8,children:(0,n.jsx)(o.A,{title:"请求次数",value:s,prefix:(0,n.jsx)(y.A,{})})}),(0,n.jsx)(a.A,{span:8,children:(0,n.jsx)(o.A,{title:"Pending请求",value:v.globalRequestDeduplicator.getPendingCount(),prefix:(0,n.jsx)(A.A,{})})})]}),(0,n.jsx)(d.A,{}),(0,n.jsx)(u.Ay,{icon:(0,n.jsx)(g.A,{}),onClick:()=>{t(0),_(0),v.globalRequestDeduplicator.clearAll(),l.Ay.success("统计已重置")},children:"重置统计"})]}),(0,n.jsxs)(i.A,{title:"1. 防重复提交（异步操作）",className:"request-control-demo__card",children:[(0,n.jsx)(h.A,{message:"功能说明",description:"在前一个请求未完成前，重复点击按钮将被拦截，防止重复提交。",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,n.jsxs)(p.A,{children:[(0,n.jsx)(u.Ay,{type:"primary",onClick:()=>b(),children:"提交表单（2秒延迟）"}),(0,n.jsx)("span",{className:"request-control-demo__hint",children:"快速点击多次，只会执行一次"})]})]}),(0,n.jsxs)(i.A,{title:"2. 基于签名的防重复（不同参数）",className:"request-control-demo__card",children:[(0,n.jsx)(h.A,{message:"功能说明",description:"根据请求参数生成签名，相同参数的请求在处理期间不会重复执行。",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,n.jsxs)(p.A,{children:[(0,n.jsx)(u.Ay,{type:"primary",onClick:()=>k(1),children:"加载用户1数据"}),(0,n.jsx)(u.Ay,{type:"primary",onClick:()=>k(2),children:"加载用户2数据"}),(0,n.jsx)(u.Ay,{type:"primary",onClick:()=>k(1),children:"再次加载用户1"})]}),(0,n.jsx)("p",{className:"request-control-demo__hint",children:"点击相同用户的按钮会被拦截，不同用户的请求可以并发"})]}),(0,n.jsxs)(i.A,{title:"3. 同步操作防抖",className:"request-control-demo__card",children:[(0,n.jsx)(h.A,{message:"功能说明",description:"防止快速重复点击触发多次同步操作（非异步请求场景）。",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,n.jsxs)(p.A,{children:[(0,n.jsx)(u.Ay,{onClick:w,children:"快速点击测试"}),(0,n.jsx)("span",{className:"request-control-demo__hint",children:"1秒内只会响应一次点击"})]})]}),(0,n.jsx)(i.A,{title:"技术实现",className:"request-control-demo__card",children:(0,n.jsxs)(m.A,{column:1,bordered:!0,children:[(0,n.jsx)(m.A.Item,{label:"防重复提交",children:(0,n.jsxs)("div",{children:[(0,n.jsx)(x.A,{color:"blue",children:"usePreventDuplicate Hook"}),(0,n.jsx)("p",{style:{marginTop:8,marginBottom:0},children:"通过 loading 状态确保异步函数完全执行完成后才允许下次调用"})]})}),(0,n.jsx)(m.A.Item,{label:"基于签名防重",children:(0,n.jsxs)("div",{children:[(0,n.jsx)(x.A,{color:"blue",children:"usePreventDuplicateBySign Hook"}),(0,n.jsx)("p",{style:{marginTop:8,marginBottom:0},children:"               根据请求参数生成唯一签名，确保相同签名的请求完全执行完成后才允许下次调用，不同签名可并发"})]})}),(0,n.jsx)(m.A.Item,{label:"请求去重",children:(0,n.jsxs)("div",{children:[(0,n.jsx)(x.A,{color:"orange",children:"RequestDeduplicator Class"}),(0,n.jsx)("p",{style:{marginTop:8,marginBottom:0},children:"缓存相同请求的 Promise，避免重复发送相同的 HTTP 请求"})]})}),(0,n.jsx)(m.A.Item,{label:"集成方式",children:(0,n.jsxs)("div",{children:[(0,n.jsx)(x.A,{color:"purple",children:"requestWithDedup API"}),(0,n.jsx)("p",{style:{marginTop:8,marginBottom:0},children:"在 req.ts 中提供带去重功能的请求方法，防止相同请求重复发送"})]})})]})})]})}},8161(e,t,s){s.r(t),s.d(t,{RequestDeduplicator:()=>r,globalRequestDeduplicator:()=>l});var n=s(50467);class r{generateKey(e,t,s){let n=s?JSON.stringify(s):"";return`${t.toUpperCase()}:${e}:${n}`}async execute(e,t,s,n){if(!this.enabled)return s();let r=this.generateKey(e,t,n),l=this.pendingRequests.get(r);if(l)return l;let i=s().then(e=>(this.pendingRequests.delete(r),e)).catch(e=>{throw this.pendingRequests.delete(r),e});return this.pendingRequests.set(r,i),i}clearAll(){this.pendingRequests.clear()}getPendingCount(){return this.pendingRequests.size}setEnabled(e){this.enabled=e,e||this.clearAll()}constructor(e=!0){(0,n._)(this,"pendingRequests",new Map),(0,n._)(this,"enabled",void 0),this.enabled=e}}let l=new r(!0)}}]);