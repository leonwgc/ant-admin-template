"use strict";(self.webpackChunkneat_admin_template=self.webpackChunkneat_admin_template||[]).push([["7593"],{24759(e,a,s){s.r(a)},49856(e,a,s){s.r(a),s.d(a,{default:()=>x});var r=s(74848),l=s(96540),i=s(17125),t=s(15742),n=s(36813),d=s(58607),u=s(68727),c=s(7532),o=s(46029),g=s(38623),m=s(5100),p=s(92050),h=s(24784);s(24759);let x=e=>{let{maxCount:a=5,maxSize:s=5,accept:x=".jpg,.jpeg,.png",value:_=[],onChange:j,mode:f="dragger",disabled:v=!1,customUpload:y,onUploadStart:N,onUploadEnd:A,concurrentLimit:k=3,showProgress:C=!1}=e,[w,b]=(0,l.useState)(""),[M,P]=(0,l.useState)(!1),F=(0,l.useRef)(null),z=(0,l.useCallback)(e=>x.split(",").some(a=>e.type.includes(a.replace(".","")))?e.size/1024/1024<s||(i.Ay.error("File size must be less than 5MB"),!1):(i.Ay.error("Only JPG/PNG files are allowed"),!1),[x,s]),I=(0,l.useCallback)(e=>{if(!e||0===e.length)return;if("dragger"===f){if(e.length>1)return void i.Ay.error(`dragger 模式只能上传 1 张图片`)}else if(_.length+e.length>a)return void i.Ay.error(`最多只能上传 ${a} 张图片`);let s=Array.from(e).filter(z);if(0===s.length)return;null==N||N();let r=new p.default(k),l=0,t="dragger"===f?[]:[..._];s.map(e=>{let a=new FileReader;a.onload=a=>{var i;let n=null==(i=a.target)?void 0:i.result,d={url:n,status:"uploading",percent:0,id:`${Date.now()}-${Math.random()}`};t.push(d),null==j||j([...t]),r.addTask(()=>{let a=0,r=!1,i=()=>{if(r||a>=90)return;let e=a<30?8*Math.random()+5:a<60?5*Math.random()+3:3*Math.random()+1;a=Math.min(90,a+e);let s=t.findIndex(e=>e.id===d.id);-1!==s&&(t[s]={...d,percent:Math.floor(a)},null==j||j([...t])),setTimeout(i,100)};return C&&i(),(y?y(e):(0,h.uploadImage)(e)).then(e=>{r=!0;let a=t.findIndex(e=>e.id===d.id);-1!==a&&(t[a]={url:e,status:"done",percent:100,id:e},null==j||j([...t]))}).catch(()=>{r=!0;let e=t.findIndex(e=>e.id===d.id);-1!==e&&(t[e]={url:n,status:"error",percent:0,id:d.id},null==j||j([...t]))}).finally(()=>{(l+=1)===s.length&&(null==A||A())})})},a.readAsDataURL(e)})},[f,z,N,k,_,a,j,y,A,C]),D=e=>{let a=_.filter(a=>a.url!==e);null==j||j(a),i.Ay.success("删除成功")},T=e=>{b(e),P(!0)},q=()=>{var e;null==(e=F.current)||e.click()},R=_.length<a&&!v;return(0,r.jsxs)("div",{className:"image-upload",children:[(0,r.jsx)("input",{ref:F,type:"file",accept:x,multiple:"dragger"!==f,style:{display:"none"},onChange:e=>I(e.target.files),disabled:v}),"dragger"===f&&(0,r.jsx)("div",{className:"image-upload__dragger-container",children:0===_.length?(0,r.jsxs)("div",{className:"image-upload__dragger",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),v||I(e.dataTransfer.files)},onClick:q,children:[(0,r.jsx)("p",{className:"image-upload__dragger-icon",children:(0,r.jsx)(u.A,{})}),(0,r.jsx)("p",{className:"image-upload__dragger-text",children:"点击或拖拽文件到此区域上传"}),(0,r.jsxs)("p",{className:"image-upload__dragger-hint",children:["支持上传 ",x," 格式的图片，单个文件不超过 ",s,"MB"]})]}):(0,r.jsxs)("div",{className:"image-upload__dragger-preview",children:["uploading"===_[0].status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("img",{src:_[0].url,className:"image-upload__dragger-image image-upload__dragger-image--uploading"}),C&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"image-upload__dragger-progress",children:(0,r.jsx)(t.A,{percent:_[0].percent||0,size:"small",status:"active",showInfo:!1})}),(0,r.jsxs)("div",{className:"image-upload__dragger-progress-text",children:[_[0].percent||0,"%"]})]})]}),"done"===_[0].status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("img",{src:_[0].url,className:"image-upload__dragger-image"}),(0,r.jsx)("div",{className:"image-upload__dragger-actions",children:(0,r.jsxs)(n.A,{children:[(0,r.jsx)(d.Ay,{type:"link",icon:(0,r.jsx)(c.A,{}),onClick:()=>T(_[0].url),children:"预览"}),(0,r.jsx)(d.Ay,{type:"link",icon:(0,r.jsx)(o.A,{}),onClick:()=>D(_[0].url),children:"删除"}),(0,r.jsx)(d.Ay,{type:"link",icon:(0,r.jsx)(g.A,{}),onClick:q,children:"重新上传"})]})})]}),"error"===_[0].status&&(0,r.jsxs)("div",{className:"image-upload__dragger-error",children:[(0,r.jsx)("p",{children:"上传失败"}),(0,r.jsx)(d.Ay,{onClick:q,children:"重新上传"})]})]})}),"button"===f&&R&&(0,r.jsxs)("div",{className:"image-upload__button-wrapper",children:[(0,r.jsx)(d.Ay,{icon:(0,r.jsx)(g.A,{}),onClick:q,disabled:v,children:"上传图片"}),(0,r.jsxs)("span",{className:"image-upload__hint",children:["（最多 ",a," 张，单张不超过 ",s,"MB）"]})]}),"button"===f&&_.length>0&&(0,r.jsx)("div",{className:"image-upload__list",children:_.map(e=>(0,r.jsxs)("div",{className:"image-upload__item",children:["uploading"===e.status&&(0,r.jsxs)("div",{className:"image-upload__item-uploading",children:[(0,r.jsx)("img",{src:e.url,className:"image-upload__item-image image-upload__item-image--uploading"}),C&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"image-upload__item-progress",children:(0,r.jsx)(t.A,{percent:e.percent||0,size:"small",status:"active",showInfo:!1})}),(0,r.jsxs)("div",{className:"image-upload__item-progress-text",children:[e.percent||0,"%"]})]})]}),"done"===e.status&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"image-upload__item-thumbnail",children:[(0,r.jsx)("img",{src:e.url}),(0,r.jsx)("div",{className:"image-upload__item-actions",children:(0,r.jsxs)(n.A,{children:[(0,r.jsx)(d.Ay,{type:"link",icon:(0,r.jsx)(c.A,{}),onClick:()=>T(e.url),size:"small"}),(0,r.jsx)(d.Ay,{type:"link",danger:!0,icon:(0,r.jsx)(o.A,{}),onClick:()=>D(e.url),size:"small"})]})})]})}),"error"===e.status&&(0,r.jsxs)("div",{className:"image-upload__item-error",children:[(0,r.jsx)("span",{className:"image-upload__item-error-text",children:"上传失败"}),(0,r.jsx)(d.Ay,{type:"link",danger:!0,icon:(0,r.jsx)(o.A,{}),onClick:()=>D(e.url),size:"small"})]})]},e.id||e.url))}),M&&(0,r.jsxs)("div",{className:"image-upload__preview",onClick:()=>P(!1),children:[(0,r.jsx)(m.A,{className:"image-upload__preview-close"}),(0,r.jsx)("div",{className:"image-upload__preview-content",onClick:e=>e.stopPropagation(),children:(0,r.jsx)("img",{src:w,alt:"Preview"})})]})]})}},92050(e,a,s){function r(e){this.maxConcurrent=e,this.currentCount=0,this.queue=[]}s.r(a),s.d(a,{default:()=>l}),r.prototype.addTask=function(e){return new Promise((a,s)=>{this.queue.push({task:e,resolve:a,reject:s}),this.processQueue()})},r.prototype.processQueue=function(){if(this.currentCount>=this.maxConcurrent||0===this.queue.length)return;let{task:e,resolve:a,reject:s}=this.queue.shift();this.currentCount++,e().then(a).catch(s).finally(()=>{this.currentCount--,this.processQueue()})},r.prototype.checkFinish=function(){return new Promise(e=>{let a=()=>{0===this.currentCount&&0===this.queue.length?e(!0):setTimeout(a,100)};a()})};let l=r},24784(e,a,s){s.r(a),s.d(a,{uploadImage:()=>r});let r=async e=>new Promise(a=>{setTimeout(()=>{a(URL.createObjectURL(e))},1e3)})}}]);